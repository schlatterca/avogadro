"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const y=require("vue");function D(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),t.push.apply(t,r)}return t}function B(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?D(Object(t),!0).forEach(function(r){q(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function q(e,n,t){return n=F(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function F(e){var n=H(e,"string");return typeof n=="symbol"?n:n+""}function H(e,n){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,n||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function T(e){return e._type==="span"&&"text"in e&&typeof e.text=="string"&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(n=>typeof n=="string"))}function L(e){return typeof e._type=="string"&&e._type[0]!=="@"&&(!("markDefs"in e)||!e.markDefs||Array.isArray(e.markDefs)&&e.markDefs.every(n=>typeof n._key=="string"))&&"children"in e&&Array.isArray(e.children)&&e.children.every(n=>typeof n=="object"&&"_type"in n)}function A(e){return L(e)&&"listItem"in e&&typeof e.listItem=="string"&&(typeof e.level>"u"||typeof e.level=="number")}function E(e){return e._type==="@list"}function N(e){return e._type==="@span"}function U(e){return e._type==="@text"}const M=["strong","em","code","underline","strike-through"];function R(e,n,t){if(!T(e)||!e.marks)return[];if(!e.marks.length)return[];const r=e.marks.slice(),c={};return r.forEach(i=>{c[i]=1;for(let s=n+1;s<t.length;s++){const f=t[s];if(f&&T(f)&&Array.isArray(f.marks)&&f.marks.indexOf(i)!==-1)c[i]++;else break}}),r.sort((i,s)=>z(c,i,s))}function z(e,n,t){const r=e[n],c=e[t];if(r!==c)return c-r;const i=M.indexOf(n),s=M.indexOf(t);return i!==s?i-s:n.localeCompare(t)}function V(e){var n;const{children:t,markDefs:r=[]}=e;if(!t||!t.length)return[];const c=t.map(R),i={_type:"@span",children:[],markType:"<unknown>"};let s=[i];for(let f=0;f<t.length;f++){const d=t[f];if(!d)continue;const w=c[f]||[];let b=1;if(s.length>1)for(b;b<s.length;b++){const o=((n=s[b])==null?void 0:n.markKey)||"",u=w.indexOf(o);if(u===-1)break;w.splice(u,1)}s=s.slice(0,b);let l=s[s.length-1];if(l){for(const o of w){const u=r.find(m=>m._key===o),h=u?u._type:o,a={_type:"@span",_key:d._key,children:[],markDef:u,markType:h,markKey:o};l.children.push(a),s.push(a),l=a}if(T(d)){const o=d.text.split(`
`);for(let u=o.length;u-- >1;)o.splice(u,0,`
`);l.children=l.children.concat(o.map(u=>({_type:"@text",text:u})))}else l.children=l.children.concat(d)}}return i.children}function G(e,n){const t=[];let r;for(let c=0;c<e.length;c++){const i=e[c];if(i){if(!A(i)){t.push(i),r=void 0;continue}if(!r){r=O(i,c,n),t.push(r);continue}if(J(i,r)){r.children.push(i);continue}if((i.level||1)>r.level){const s=O(i,c,n);if(n==="html"){const f=r.children[r.children.length-1],d=B(B({},f),{},{children:[...f.children,s]});r.children[r.children.length-1]=d}else r.children.push(s);r=s;continue}if((i.level||1)<r.level){const s=t[t.length-1],f=s&&P(s,i);if(f){r=f,r.children.push(i);continue}r=O(i,c,n),t.push(r);continue}if(i.listItem!==r.listItem){const s=t[t.length-1],f=s&&P(s,{level:i.level||1});if(f&&f.listItem===i.listItem){r=f,r.children.push(i);continue}else{r=O(i,c,n),t.push(r);continue}}console.warn("Unknown state encountered for block",i),t.push(i)}}return t}function J(e,n){return(e.level||1)===n.level&&e.listItem===n.listItem}function O(e,n,t){return{_type:"@list",_key:`${e._key||`${n}`}-parent`,mode:t,level:e.level||1,listItem:e.listItem,children:[e]}}function P(e,n){const t=n.level||1,r=n.listItem||"normal",c=typeof n.listItem=="string";if(E(e)&&(e.level||1)===t&&c&&(e.listItem||"normal")===r)return e;if(!("children"in e))return;const i=e.children[e.children.length-1];return i&&!T(i)?P(i,n):void 0}function C(e){let n="";return e.children.forEach(t=>{U(t)?n+=t.text:N(t)&&(n+=C(t))}),n}const Q=/^\s/,X=/^\s/;function Y(e){const n=Array.isArray(e)?e:[e];let t="";return n.forEach((r,c)=>{if(!L(r))return;let i=!1;r.children.forEach(s=>{T(s)?(t+=i&&t&&!X.test(t)&&!Q.test(s.text)?" ":"",t+=s.text,i=!1):i=!0}),c!==n.length-1&&(t+=`

`)}),t}const Z="html";function K(e,n){const{block:t,list:r,listItem:c,marks:i,types:s,...f}=n;return{...e,block:I(e,n,"block"),list:I(e,n,"list"),listItem:I(e,n,"listItem"),marks:I(e,n,"marks"),types:I(e,n,"types"),...f}}function I(e,n,t){const r=n[t],c=e[t];return typeof r=="function"||r&&typeof c=="function"?r:r?{...c,...r}:c}const p=e=>(n,{slots:t})=>{var r;return y.h(e,(r=t.default)==null?void 0:r.call(t))},ee=({value:e},{slots:n})=>{var t;return y.h("a",{href:e==null?void 0:e.href},(t=n.default)==null?void 0:t.call(n))},te={textDecoration:"underline"},ne={code:p("code"),em:p("em"),link:ee,"strike-through":p("del"),strong:p("strong"),underline:(e,{slots:n})=>{var t;return y.h("span",{style:te},(t=n.default)==null?void 0:t.call(n))}},re={number:p("ol"),bullet:p("ul")},ie=p("li"),x=(e,n)=>`[@portabletext/vue] Unknown ${e}, specify a component for it in the \`components.${n}\` prop`,W=e=>x(`block type "${e}"`,"types"),le=e=>x(`mark type "${e}"`,"marks"),oe=e=>x(`block style "${e}"`,"block"),se=e=>x(`list style "${e}"`,"list"),ce=e=>x(`list item style "${e}"`,"listItem");function ue(e){console.warn(e)}const j={display:"none"},ae=({value:e,isInline:n})=>{const t=W(e._type);return n?y.h("span",{style:j},t):y.h("div",{style:j},t)},fe=({markType:e},{slots:n})=>{var t;return y.h("span",{class:`unknown__pt__mark__${e}`},(t=n.default)==null?void 0:t.call(n))},ye=p("p"),pe=p("ul"),he=p("li"),ke=()=>y.h("br"),de={normal:p("p"),blockquote:p("blockquote"),h1:p("h1"),h2:p("h2"),h3:p("h3"),h4:p("h4"),h5:p("h5"),h6:p("h6")},S={types:{},block:de,marks:ne,list:re,listItem:ie,hardBreak:ke,unknownType:ae,unknownMark:fe,unknownList:pe,unknownListItem:he,unknownBlockStyle:ye},me=(e,n=!1)=>t=>{if(n){const{value:r,...c}=t;return y.h(e,{...c,...r})}return y.h(e,{...t.value})},ge=(e,n)=>{function t(l){const{node:o,index:u,isInline:h}=l,a=o._key||`node-${u}`;return E(o)?i(o,u,a):A(o)?c(o,u,a):N(o)?s(o,u,a):r(o)?b(o,u,a,h):L(o)?f(o,u,a,h):U(o)?d(o,a):w(o,u,a,h)}function r(l){return l._type in e.types}function c(l,o,u){const h=$({node:l,index:o,isInline:!1,renderNode:t}),a=e.listItem,g=(typeof a=="function"?a:a[l.listItem])||e.unknownListItem;if(g===e.unknownListItem){const _=l.listItem||"bullet";n(ce(_),{type:_,nodeType:"listItemStyle"})}let k=h.children;if(l.style&&l.style!=="normal"){const{listItem:_,...v}=l;k=t({node:v,index:o,isInline:!1,renderNode:t})}return y.h(g,{key:u,value:l,index:o,isInline:!1,renderNode:t},()=>k)}function i(l,o,u){const h=l.children.map((k,_)=>t({node:k._key?k:{...k,_key:`li-${o}-${_}`},index:_,isInline:!1,renderNode:t})),a=e.list,g=(typeof a=="function"?a:a[l.listItem])||e.unknownList;if(g===e.unknownList){const k=l.listItem||"bullet";n(se(k),{nodeType:"listStyle",type:k})}return y.h(g,{key:u,value:l,index:o,isInline:!1,renderNode:t},()=>h)}function s(l,o,u){const{markDef:h,markType:a,markKey:m}=l,g=e.marks[a]||e.unknownMark,k=l.children.map((_,v)=>t({node:_,index:v,isInline:!0,renderNode:t}));return g===e.unknownMark&&n(le(a),{nodeType:"mark",type:a}),y.h(g,{key:u,text:C(l),value:h,markType:a,markKey:m,renderNode:t},()=>k)}function f(l,o,u,h){const{_key:a,children:m,...g}=$({node:l,index:o,isInline:h,renderNode:t}),k=g.node.style||"normal",v=(typeof e.block=="function"?e.block:e.block[k])||e.unknownBlockStyle;return v===e.unknownBlockStyle&&n(oe(k),{nodeType:"blockStyle",type:k}),y.h(v,{key:u,...g,value:g.node,renderNode:t},()=>m)}function d(l,o){if(l.text===`
`){const u=e.hardBreak;return u?y.h(u,{key:o}):`
`}return l.text}function w(l,o,u,h){const a={value:l,isInline:h,index:o,renderNode:t};n(W(l._type),{nodeType:"block",type:l._type});const m=e.unknownType;return y.h(m,{key:u,...a})}function b(l,o,u,h){const a={value:l,isInline:h,index:o,renderNode:t},m=e.types[l._type];return m?y.h(m,{key:u,...a}):void 0}return t};function $(e){const{node:n,index:t,isInline:r,renderNode:c}=e,s=V(n).map((f,d)=>c({node:f,isInline:!0,index:d,renderNode:c}));return{_key:n._key||`block-${t}`,children:s,index:t,isInline:r,node:n}}const be=y.defineComponent({__name:"vue-portable-text",props:{value:{},components:{},onMissingComponent:{type:[Function,Boolean],default:()=>ue},listNestingMode:{}},setup(e){function n(){}const t=e,r=()=>{const c=t.onMissingComponent||n,i=Array.isArray(t.value)?t.value:[t.value],s=G(i,t.listNestingMode||Z),f=t.components?K(S,t.components):S,d=ge(f,c);return s.map((b,l)=>d({node:b,index:l,isInline:!1,renderNode:d}))};return(c,i)=>(y.openBlock(),y.createBlock(r))}});exports.PortableText=be;exports.defaultComponents=S;exports.flattenProps=me;exports.mergeComponents=K;exports.toPlainText=Y;
